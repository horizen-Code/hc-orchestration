_format_version: "3.0"
_transform: true

services:
  # User Service
  - name: user-service
    url: http://user-service:3000
    routes:
      - name: user-service-route
        paths:
          - /api/users
          - /api/users/
        strip_path: true
        methods:
          - GET
          - POST
          - PUT
          - DELETE
          - PATCH
    plugins:
      - name: key-auth
        config:
          key_names: ["apikey"]
          hide_credentials: false
      - name: cors
        config:
          origins: ["*"]
          methods: ["GET", "POST", "PUT", "DELETE", "PATCH"]
          headers: ["Accept", "Authorization", "Content-Type"]
          credentials: true

  # Health check endpoint
  - name: health-service
    url: http://kong:8000
    routes:
      - name: health-route
        paths:
          - /health
        strip_path: false

# Consumers (API users)
consumers:
  - username: web-app
    keyauth_credentials:
      - key: web-app-key-12345

# Global plugins
plugins:
  - name: rate-limiting
    config:
      minute: 60
      hour: 1000
      policy: local
  - name: request-size-limiting
    config:
      allowed_payload_size: 128
  - name: bot-detection
    config:
      blacklist:
        - "SomeBot"
        - "AnotherBot"
